<template>
  <section class="layout-full relative min-h-screen bg-slate-950 text-white py-12 overflow-hidden">
    <div class="absolute inset-0 bg-linear-to-br from-gray-950 via-slate-950 to-black"></div>
    <div class="absolute inset-0 pointer-events-none opacity-60">
      <div class="absolute -left-24 top-10 w-[520px] h-[520px] bg-pink-600/20 blur-3xl rounded-full"></div>
      <div class="absolute right-0 -bottom-20 w-[480px] h-[480px] bg-indigo-500/15 blur-3xl rounded-full"></div>
    </div>

    <div class="relative z-10 w-full max-w-6xl mx-auto px-4">
      <div class="grid gap-8 lg:grid-cols-[1.05fr_0.95fr] items-stretch">
        <article
          class="rounded-3xl border border-white/10 bg-white/5 backdrop-blur-3xl p-10 flex flex-col gap-10 shadow-[0_35px_90px_rgba(15,23,42,0.65)]">
          <div class="space-y-6">
            <p class="eyebrow text-pink-200">P2U KAISER</p>
            <h1 class="text-4xl lg:text-5xl font-bold leading-tight text-glow">
              ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏Ñ‡∏≠‡∏°‡∏°‡∏π‡∏ô‡∏¥‡∏ï‡∏µ‡πâ‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà
            </h1>
            <p class="text-gray-100 text-lg">
              ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ preloved ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏à‡πÑ‡∏î‡πâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£
            </p>
          </div>

          <div class="space-y-4">
            <div class="flex items-center gap-3 text-gray-100">
              <span class="flex h-10 w-10 items-center justify-center rounded-full bg-white/15 text-xl">‚ú®</span>
              <p>‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç P2U Coin ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
            </div>
            <div class="flex items-center gap-3 text-gray-100">
              <span class="flex h-10 w-10 items-center justify-center rounded-full bg-white/15 text-xl">üõ°Ô∏è</span>
              <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠</p>
            </div>
            <div class="flex items-center gap-3 text-gray-100">
              <span class="flex h-10 w-10 items-center justify-center rounded-full bg-white/15 text-xl">üöÄ</span>
              <p>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏ô‡πâ‡∏≤ Shop ‡πÅ‡∏•‡∏∞‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ï</p>
            </div>
          </div>

          <div class="grid gap-6 sm:grid-cols-3 text-center">
            <div>
              <p class="text-3xl font-bold">+12K</p>
              <p class="text-sm text-gray-300 mt-1">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à</p>
            </div>
            <div>
              <p class="text-3xl font-bold">24/7</p>
              <p class="text-sm text-gray-300 mt-1">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•</p>
            </div>
            <div>
              <p class="text-3xl font-bold">‡∏ø8.5M</p>
              <p class="text-sm text-gray-300 mt-1">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</p>
            </div>
          </div>
        </article>

        <div
          class="rounded-3xl border border-white/10 bg-slate-950/80 backdrop-blur-2xl p-8 sm:p-10 shadow-[0_25px_70px_rgba(2,6,23,0.75)] space-y-6">
          <div class="space-y-2 text-center">
            <p class="text-sm uppercase tracking-[0.45em] text-pink-300">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</p>
            <h2 class="text-3xl font-semibold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° P2U Kaiser</h2>
            <p class="text-gray-400 text-sm">
              ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å
            </p>
          </div>

          <form class="space-y-5" @submit.prevent="handleRegister">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm text-gray-300">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                <input v-model="username" class="input-style" placeholder="username"
                  autocomplete="username" />
              </div>
              <div>
                <label class="text-sm text-gray-300">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                <input v-model="email" type="email" class="input-style" placeholder="your@email.com"
                  autocomplete="email" />
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm text-gray-300">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input v-model="password" type="password" class="input-style" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  autocomplete="new-password" />
              </div>
              <div>
                <label class="text-sm text-gray-300">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input v-model="confirmPassword" type="password" class="input-style" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  autocomplete="new-password" />
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm text-gray-300">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                <input v-model="full_name" class="input-style" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" autocomplete="name" />
              </div>
              <div>
                <label class="text-sm text-gray-300">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                <input v-model="phone_number" class="input-style" placeholder="08X-XXX-XXXX" autocomplete="tel" />
              </div>
            </div>

            <div>
              <label class="text-sm text-gray-300">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</label>
              <label
                class="mt-2 flex items-center justify-between rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-gray-300 cursor-pointer hover:border-pink-400 transition">
                <span>{{ profile_image?.name || '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå .png ‡∏´‡∏£‡∏∑‡∏≠ .jpg' }}</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24">
                  <path fill="currentColor"
                    d="M12 16q.425 0 .713-.288T13 15v-3h3q.425 0 .713-.288T17 11t-.288-.712T16 10h-3V7q0-.425-.288-.712T12 6t-.712.288T11 7v3H8q-.425 0-.712.288T7 11t.288.712T8 12h3v3q0 .425.288.713T12 16m0 6q-2.075 0-3.9-.788t-3.2-2.137t-2.138-3.2T2 12t.762-3.875t2.138-3.2T8.1 2.788T12 2t3.9.788t3.2 2.137t2.137 3.2T22 12q0 2.05-.762 3.875t-2.138 3.2t-3.2 2.137T12 22" />
                </svg>
                <input type="file" class="sr-only" @change="handleImageUpload" />
              </label>
            </div>

            <button type="submit"
              class="w-full rounded-2xl bg-pink-600/90 hover:bg-pink-500 text-white font-semibold py-3 transition shadow-lg shadow-pink-500/25 focus:outline-none focus:ring-2 focus:ring-pink-300 focus:ring-offset-2 focus:ring-offset-slate-950">
              ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
            </button>
          </form>

          <p v-if="errorMsg" class="text-center text-sm text-red-300">
            {{ errorMsg }}
          </p>

          <p class="text-center text-sm text-gray-400">
            ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß?
            <NuxtLink to="/login" class="text-pink-300 font-semibold hover:text-white transition">
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </NuxtLink>
          </p>
        </div>
      </div>
    </div>
  </section>
</template>


<script setup>
import axios from 'axios';
import { ref } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter();

const username = ref('');
const email = ref('');
const password = ref('');
const confirmPassword = ref('');
const full_name = ref('');
const phone_number = ref('');
const profile_image = ref(null);
const errorMsg = ref('');

const handleImageUpload = (event) => {
  profile_image.value = event.target.files[0];
};

const handleRegister = async () => {
  errorMsg.value = '';
  if (!username.value || !email.value || !password.value || !full_name.value) {
    errorMsg.value = 'Please fill in all required fields.';
    return;
  }

  if (password.value !== confirmPassword.value) {
    errorMsg.value = 'Passwords do not match.';
    return;
  }

  const formData = new FormData();
  formData.append('username', username.value);
  formData.append('email', email.value);
  formData.append('password', password.value);
  formData.append('full_name', full_name.value);
  formData.append('phone_number', phone_number.value);
  if (profile_image.value) {
    formData.append('profile_image', profile_image.value);
  }

  try {
    const response = await axios.post('http://localhost:5000/api/register', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    });
    console.log('Registration successful:', response.data);

    // ‚úÖ ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    router.push({ name: 'VerifyEmail', query: { email: email.value } });
  } catch (err) {
    console.error('[Register error]', err.response?.data?.msg || err.message);
    errorMsg.value = err.response?.data?.msg || 'Registration failed. Please try again.';
  }
};
</script>

<style scoped lang="postcss">
.input-style {
  @apply w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-gray-400
    focus:outline-none focus:ring-2 focus:ring-pink-400/80 focus:border-transparent transition
    backdrop-blur-md;
}
</style>